<div class="h-screen bg-gray-50 overflow-hidden flex flex-col p-4">
  <!-- Header superior con icono -->
  <div class="bg-header-purple px-6 py-4 flex items-center justify-between rounded-2xl shadow-sm mb-3">
    <!-- Logo izquierda -->
    <div class="flex-shrink-0">
      <img src="assets/logo/logo-corto.png" alt="Logo" class="h-14 w-auto">
    </div>

    <!-- Texto centrado -->
    <div class="flex-1 text-center">
      <h1 class="text-xl font-bold text-gray-900">Registrar Incidencia</h1>
      <p class="text-xs text-gray-600 mt-0.5">Completa el formulario con los detalles de tu incidencia</p>
    </div>

    <!-- Icono derecha -->
    <div class="flex-shrink-0 p-2.5 bg-white rounded-xl shadow-sm">
      <svg class="w-7 h-7 text-oceanix-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
    </div>
  </div>

  <!-- Grid principal: Formulario + Historial -->
  <div class="flex-1 grid transition-all duration-300 overflow-hidden"
       [ngClass]="historialVisible() ? 'grid-cols-[58%_42%]' : 'grid-cols-[100%_0%]'">

    <!-- COLUMNA IZQUIERDA: FORMULARIO -->
    <div class="h-full overflow-y-auto px-4 py-2">
      <form (ngSubmit)="enviarIncidencia()" class="space-y-2.5">

        <!-- Sección 1: Información de la Empresa -->
        <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-200">
          <div class="flex items-center gap-2 mb-3">
            <svg class="w-4 h-4 text-oceanix-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
            <h2 class="text-sm font-semibold text-gray-900">Información de la Empresa</h2>
          </div>

          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1.5">
              Empresa <span class="text-red-500">*</span>
            </label>
            <select
              [(ngModel)]="empresaSeleccionada"
              name="empresa"
              required
              class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-oceanix-purple-500 focus:border-transparent text-gray-900"
            >
              <option value="">Selecciona tu empresa</option>
              <option value="DHL">DHL</option>
              <option value="FedEx">FedEx</option>
              <option value="UPS">UPS</option>
              <option value="Coordinadora">Coordinadora</option>
              <option value="Servientrega">Servientrega</option>
            </select>
          </div>
        </div>

        <!-- Sección 2: Detalles de Incidencia -->
        <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-200">
          <div class="flex items-center gap-2 mb-3">
            <svg class="w-4 h-4 text-oceanix-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <h2 class="text-sm font-semibold text-gray-900">Detalles de Incidencia</h2>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1.5">
                Número de Guía <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                [(ngModel)]="numeroGuia"
                name="numeroGuia"
                placeholder="DU-1234567890"
                required
                class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-oceanix-purple-500 focus:border-transparent text-gray-900 placeholder-gray-400"
              />
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1.5">
                Tipo de Incidencia <span class="text-red-500">*</span>
              </label>
              <select
                [(ngModel)]="tipoIncidencia"
                name="tipoIncidencia"
                required
                class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-oceanix-purple-500 focus:border-transparent text-gray-900"
              >
                <option value="">Selecciona tipo</option>
                <option value="Pérdida">Pérdida</option>
                <option value="Daño">Daño</option>
                <option value="Retraso">Retraso</option>
                <option value="Extravío">Extravío</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Sección 3: Evidencia y Descripción -->
        <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-200">
          <div class="flex items-center gap-2 mb-3">
            <svg class="w-4 h-4 text-oceanix-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            <h2 class="text-sm font-semibold text-gray-900">Evidencia y Descripción</h2>
          </div>

          <div class="space-y-3">
            <!-- Upload de imagen compacto -->
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1.5">
                Foto de Compra (Opcional)
              </label>
              <label class="flex flex-col items-center justify-center w-full h-20 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-all">
                <div class="flex flex-col items-center justify-center">
                  <svg class="w-6 h-6 mb-1 text-oceanix-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                  </svg>
                  <p class="text-xs text-gray-500"><span class="font-semibold">Subir imagen</span></p>
                  <p class="text-[10px] text-gray-400">PNG, JPG hasta 5MB</p>
                </div>
                <input type="file" class="hidden" accept="image/png,image/jpeg,image/jpg" (change)="onFileSelected($event)" />
              </label>
              @if (archivoSeleccionado) {
                <p class="mt-1 text-xs text-green-600">✓ {{ archivoSeleccionado.name }}</p>
              }
            </div>

            <!-- Descripción compacta -->
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1.5">
                Descripción Detallada <span class="text-red-500">*</span>
              </label>
              <textarea
                [(ngModel)]="descripcion"
                name="descripcion"
                rows="2"
                placeholder="Describe detalladamente lo sucedido con tu envío..."
                required
                class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-oceanix-purple-500 focus:border-transparent text-gray-900 placeholder-gray-400 resize-none"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Botones de acción -->
        <div class="flex gap-3 pt-2">
          <button
            type="submit"
            class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-oceanix-purple-600 hover:bg-oceanix-purple-700 text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transition-all"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Enviar Incidencia
          </button>
          <button
            type="button"
            (click)="cancelar()"
            class="px-4 py-2.5 bg-white border-2 border-gray-300 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-50 transition-all"
          >
            Cancelar
          </button>
        </div>
      </form>

      <!-- Footer de ayuda compacto -->
      <div class="mt-3 pt-3 border-t border-gray-200 text-center">
        <p class="text-xs text-gray-600">
          ¿Necesitas ayuda?
          <a href="tel:+573001234567" class="text-oceanix-purple-600 hover:underline font-medium ml-1">
            <svg class="w-3 h-3 inline mr-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
            +57 300 123 4567
          </a>
        </p>
      </div>
    </div>

    <!-- COLUMNA DERECHA: HISTORIAL -->
    <div class="h-full bg-white border-l border-gray-200 flex flex-col overflow-hidden">
      <!-- Header del historial -->
      <div class="px-4 py-3 border-b border-gray-200 bg-purple-50">
        <h2 class="text-base font-bold text-gray-900">Historial</h2>
        <p class="text-xs text-gray-600">Tus incidencias reportadas</p>
      </div>

      <!-- Lista de incidencias -->
      @if (historialVisible()) {
        <div class="flex-1 overflow-y-auto p-3 space-y-2.5">
          @for (incidencia of incidencias; track incidencia.id) {
            <div class="bg-gray-50 rounded-lg p-3 border border-gray-200 hover:shadow-md transition-all">
              <!-- Header de la card -->
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="text-sm font-bold text-gray-900">{{ incidencia.id }}</span>
                  <span
                    class="px-2 py-0.5 rounded-full text-[10px] font-semibold"
                    [ngClass]="getEstadoClass(incidencia.estado)"
                  >
                    {{ incidencia.estado }}
                  </span>
                </div>
                <span class="text-[10px] text-gray-500">{{ incidencia.fecha }}</span>
              </div>

              <!-- Empresa -->
              <div class="text-xs text-gray-600 mb-2">{{ incidencia.empresa }}</div>

              <!-- Detalles en 2 columnas -->
              <div class="space-y-1 mb-2">
                <div class="flex items-start gap-1.5">
                  <span class="text-[11px] font-medium text-gray-600 w-10">Guía:</span>
                  <span class="text-[11px] text-gray-900 font-mono">{{ incidencia.guia }}</span>
                </div>
                <div class="flex items-start gap-1.5">
                  <span class="text-[11px] font-medium text-gray-600 w-10">Tipo:</span>
                  <span class="text-[11px] text-gray-900">{{ incidencia.tipo }}</span>
                </div>
              </div>

              <!-- Botón ver detalles -->
              <button
                (click)="verDetalles(incidencia)"
                class="w-full text-xs text-oceanix-purple-600 hover:text-oceanix-purple-700 font-medium flex items-center justify-center gap-1 py-1.5 hover:bg-purple-50 rounded-md transition-all"
              >
                Ver detalles
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            </div>
          }

          <!-- Mensaje footer -->
          <div class="text-center py-4">
            <p class="text-xs text-gray-500 mb-1.5">¿No encuentras tu incidencia?</p>
            <button class="text-xs text-oceanix-purple-600 hover:underline font-medium">Ver todas</button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
